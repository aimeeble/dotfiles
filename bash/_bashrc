
# Alias preferences
alias ls='ls -F'
alias ll='ls -l'
alias grep="grep --color"
alias ame.io="curl -F 'p=<-' http://ame.io/new_paste"

# Helper functions
git_branch() {
   local BRANCH=`git symbolic-ref HEAD 2>&1 | sed "s/refs\/heads\///"`

   echo "$BRANCH" | grep -qs fatal
   if [ "$?" == "0" ]; then
      unset GIT_BRANCH
   else
      export GIT_BRANCH="$BRANCH"
   fi
}

git_changes()
{
   #if [ -z "$GIT_BRANCH" ]; then
      return
   #fi

   git status | grep "directory clean" 2>&1 > /dev/null
   if [ $? -eq 0 ]; then
      unset GIT_CHANGES
   else
      export GIT_CHANGES=*
   fi
}

calc_fill_length() {
   local TERMWIDTH=$(($COLUMNS - 1))
   local HOSTNAME=`hostname -s`
   local MYPWD=${PWD/$HOME/\~}

   local MAIN="--( ${USER}@${HOSTNAME}${GIT_BRANCH:+ $GIT_BRANCH}${GIT_CHANGES:+$GIT_CHANGES}${VIRTUAL_ENV:+ `basename $VIRTUAL_ENV`} )-"
   local P="-( $MYPWD )--"
   local MAIN_LEN=${#MAIN}
   local P_LEN=${#P}
   local TOTAL_PROMPT_LEN=$(($MAIN_LEN + $P_LEN))

   export PROMPT_FILL_LEN=$(($TERMWIDTH - $TOTAL_PROMPT_LEN))
}

# Prompt
export PROMPT_FILL="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"

case "$TERM" in
xterm*|rxvt*|screen*)
    PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME}: ${PWD/$HOME/~}\007";'
    ;;
*)
    ;;
esac
PROMPT_COMMAND="${PROMPT_COMMAND}git_branch;git_changes;calc_fill_length"

PS1='\[\033[01;30m\]-\[\033[00m\]-\[\033[01;37m\]( \[\033[01;32m\]\u@\h\[\033[00m\]'
PS1+='${GIT_BRANCH:+ \[\033[01;33m\]$GIT_BRANCH\[\033[00m\]}${GIT_CHANGES:+\[\033[01;39m\]${GIT_CHANGES}\[\033[00m\]}'
PS1+='${VIRTUAL_ENV:+ \[\033[01;39m\]`basename $VIRTUAL_ENV`\[\033[00m\]} '
PS1+='\[\033[01;37m\])\[\033[00m\]-\[\033[01;30m\]${PROMPT_FILL:0:$PROMPT_FILL_LEN}'
PS1+='\[\033[00m\]-\[\033[01;37m\]( \[\033[01;34m\]\w\[\033[00m\] \[\033[01;37m\])\[\033[00m\]-\[\033[01;30m\]-\n'
PS1+='-\[\033[00m\]-\[\033[01;37m\]( \[\033[00m\]\t !\! \[\033[01;37m\])\[\033[00m\]-\[\033[01;30m\]-\[\033[00m\]\$ '
PS2='\[\033[01;30m\]MOAR\[\033[00m\]> '
export PS1 PS2

[ -f ~/.git-completion.bash ] && . ~/.git-completion.bash

# Environment
export PATH=/usr/local/bin::/usr/local/share/python:$HOME/bin:$PATH
export VISUAL=vim
export EDITOR=vim
export VIRTUAL_ENV_DISABLE_PROMPT=1

# Source the platform and local bashrc files.
PLATFORM_BASH_RC="$HOME/.bashrc-`uname -s`"
[ -f "$PLATFORM_BASH_RC" ] && . "$PLATFORM_BASH_RC"
LOCAL_BASH_RC="$HOME/.bashrc-local"
[ -f "$LOCAL_BASH_RC" ] && . "$LOCAL_BASH_RC"
